<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BDG Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen">

<!-- LOGIN SECTION -->
<div id="loginSection" class="flex items-center justify-center h-screen">
  <div class="bg-gray-800 p-8 rounded-xl w-full max-w-sm shadow-lg">
    <h1 class="text-2xl font-bold mb-4 text-center">🛡️ Admin Login</h1>
    <input type="email" id="email" placeholder="Admin Email" class="w-full mb-3 p-2 rounded text-black" />
    <input type="password" id="password" placeholder="Password" class="w-full mb-3 p-2 rounded text-black" />
    <button onclick="login()" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-2 rounded">Login</button>
    <p id="error" class="text-red-500 mt-3 text-sm text-center"></p>
  </div>
</div>

<!-- DASHBOARD SECTION -->
<div id="dashboardSection" class="hidden">
  <div class="flex">
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-800 p-4 min-h-screen">
      <h2 class="text-xl font-bold mb-6 text-center">🛡️ BDG Admin</h2>
      <ul class="space-y-3">
        <li><button onclick="showTab('gameControl')" class="w-full text-left">🎮 Game Control</button></li>
        <li><button onclick="showTab('deposit')" class="w-full text-left">💰 Deposit</button></li>
        <li><button onclick="showTab('withdrawal')" class="w-full text-left">💸 Withdrawal</button></li>
        <li><button onclick="showTab('users')" class="w-full text-left">👥 Users</button></li>
        <li><button onclick="showTab('settings')" class="w-full text-left">⚙️ Settings</button></li>
        <li><button onclick="logout()" class="w-full text-left text-red-400">🚪 Logout</button></li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 space-y-10">
      <!-- 🎮 Game Control -->
      <div id="gameControl" class="tab hidden">
        <h3 class="text-2xl font-semibold mb-4">🎮 Game Result Control</h3>
        <label class="block mb-2">Mode:</label>
        <select id="mode" class="text-black p-2 rounded mb-4">
          <option value="auto">Auto</option>
          <option value="manual">Manual</option>
        </select>
        <div id="manualInputs" class="space-y-3 hidden">
          <input type="text" id="manualNumber" placeholder="Number (0-9)" class="p-2 rounded text-black w-48" />
          <select id="manualColor" class="text-black p-2 rounded w-48">
            <option value="Red">Red</option>
            <option value="Green">Green</option>
            <option value="Violet">Violet</option>
          </select>
          <select id="manualSize" class="text-black p-2 rounded w-48">
            <option value="Big">Big</option>
            <option value="Small">Small</option>
          </select>
          <button onclick="setManualResult()" class="bg-green-600 hover:bg-green-700 text-white p-2 rounded">✅ Set Result</button>
        </div>
      </div>

      <!-- 💰 Deposit -->
      <div id="deposit" class="tab hidden">
        <h3 class="text-2xl font-semibold mb-4">💰 Deposit Requests</h3>
        <div id="depositList" class="space-y-4">Loading...</div>
      </div>

      <!-- 💸 Withdrawal -->
      <div id="withdrawal" class="tab hidden">
        <h3 class="text-2xl font-semibold mb-4">💸 Withdrawal Requests</h3>
        <div id="withdrawalList" class="space-y-4">Loading...</div>
      </div>

      <!-- 👥 Users -->
      <div id="users" class="tab hidden">
        <h3 class="text-2xl font-semibold mb-4">👥 All Users</h3>
        <div id="userList" class="space-y-4">Loading...</div>
      </div>

      <!-- ⚙️ Settings -->
      <div id="settings" class="tab hidden">
        <h3 class="text-2xl font-semibold mb-4">📢 Announcement</h3>
        <textarea id="announcement" placeholder="Enter announcement..." class="w-full p-2 rounded text-black h-32 mb-4"></textarea>
        <button onclick="sendAnnouncement()" class="bg-blue-600 hover:bg-blue-700 p-2 rounded">📢 Send</button>
      </div>
    </main>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBZ0oT94kfVDpUnLxW_X2P2o-KLSBcDHjw",
    authDomain: "bdg-game-f3ffc.firebaseapp.com",
    databaseURL: "https://bdg-game-f3ffc-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "bdg-game-f3ffc",
    storageBucket: "bdg-game-f3ffc.appspot.com",
    messagingSenderId: "1022590376869",
    appId: "1:1022590376869:web:262c7a345f9044a5e5264c"
  };
  firebase.initializeApp(firebaseConfig);

  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    firebase.auth().signInWithEmailAndPassword(email, password)
      .then(() => {
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("dashboardSection").classList.remove("hidden");
        showTab("gameControl");
        loadDepositRequests();
        loadWithdrawalRequests();
        loadUsers();
      })
      .catch(error => {
        document.getElementById("error").innerText = error.message;
      });
  }

  function logout() {
    firebase.auth().signOut().then(() => {
      document.getElementById("dashboardSection").classList.add("hidden");
      document.getElementById("loginSection").classList.remove("hidden");
    });
  }

  function showTab(id) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  }

  document.getElementById("mode").addEventListener("change", function () {
    document.getElementById("manualInputs").style.display =
      this.value === "manual" ? "block" : "none";
  });

  function setManualResult() {
    const number = document.getElementById("manualNumber").value;
    const color = document.getElementById("manualColor").value;
    const size = document.getElementById("manualSize").value;
    const currentPeriod = Date.now();
    firebase.database().ref("manualResults/" + currentPeriod).set({
      number, color, size
    }).then(() => alert("✅ Result set."));
  }

  function sendAnnouncement() {
    const text = document.getElementById("announcement").value;
    firebase.database().ref("announcement").set({ message: text });
    alert("📢 Announcement sent!");
  }

  function loadDepositRequests() {
    const depositList = document.getElementById("depositList");
    firebase.database().ref("depositRequests").on("value", (snapshot) => {
      const data = snapshot.val();
      depositList.innerHTML = "";
      if (!data) return depositList.innerHTML = "No deposit requests.";
      Object.entries(data).forEach(([uid, req]) => {
        depositList.innerHTML += `
          <div class="bg-gray-700 p-4 rounded">
            <p>UID: ${uid}</p>
            <p>Amount: ₹${req.amount}</p>
            <p>UTR: ${req.utr}</p>
            <img src="${req.screenshot}" class="w-24 mt-2" />
            <div class="mt-2 space-x-2">
              <button onclick="approveDeposit('${uid}', ${req.amount})" class="bg-green-600 px-3 py-1 rounded">✅ Approve</button>
              <button onclick="rejectDeposit('${uid}')" class="bg-red-600 px-3 py-1 rounded">❌ Reject</button>
            </div>
          </div>`;
      });
    });
  }

  function approveDeposit(uid, amount) {
    const userRef = firebase.database().ref("users/" + uid);
    userRef.once("value").then(snapshot => {
      const wallet = snapshot.val()?.wallet || 0;
      userRef.update({ wallet: wallet + amount });
      firebase.database().ref("depositRequests/" + uid).remove();
      alert("✅ Deposit approved.");
    });
  }

  function rejectDeposit(uid) {
    firebase.database().ref("depositRequests/" + uid).remove();
    alert("❌ Request rejected.");
  }

  function loadWithdrawalRequests() {
    const withdrawalList = document.getElementById("withdrawalList");
    firebase.database().ref("withdrawalRequests").on("value", (snapshot) => {
      const data = snapshot.val();
      withdrawalList.innerHTML = "";
      if (!data) return withdrawalList.innerHTML = "No withdrawal requests.";
      Object.entries(data).forEach(([uid, req]) => {
        withdrawalList.innerHTML += `
          <div class="bg-gray-700 p-4 rounded">
            <p>UID: ${uid}</p>
            <p>Amount: ₹${req.amount}</p>
            <p>Account: ${req.accountNumber}</p>
            <p>IFSC: ${req.ifsc}</p>
            <p>Holder: ${req.accountHolder}</p>
            <div class="mt-2 space-x-2">
              <button onclick="approveWithdrawal('${uid}')" class="bg-green-600 px-3 py-1 rounded">✅ Approve</button>
              <button onclick="rejectWithdrawal('${uid}')" class="bg-red-600 px-3 py-1 rounded">❌ Reject</button>
            </div>
          </div>`;
      });
    });
  }

  function approveWithdrawal(uid) {
    firebase.database().ref("withdrawalRequests/" + uid).remove();
    alert("✅ Withdrawal approved (handle bank manually).");
  }

  function rejectWithdrawal(uid) {
    firebase.database().ref("withdrawalRequests/" + uid).remove();
    alert("❌ Withdrawal rejected.");
  }

  function loadUsers() {
    const userList = document.getElementById("userList");
    firebase.database().ref("users").on("value", (snapshot) => {
      const data = snapshot.val();
      userList.innerHTML = "";
      if (!data) return userList.innerHTML = "No users found.";
      Object.entries(data).forEach(([uid, user]) => {
        userList.innerHTML += `
          <div class="bg-gray-700 p-4 rounded">
            <p>UID: ${uid}</p>
            <p>Name: ${user.name || 'N/A'}</p>
            <p>Wallet: ₹${user.wallet || 0}</p>
          </div>`;
      });
    });
  }
</script>

</body>
</html>
